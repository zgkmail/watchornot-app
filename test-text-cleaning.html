<!DOCTYPE html>
<html>
<head>
    <title>Text Cleaning Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-case {
            background: #2a2a2a;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #4CAF50;
        }
        .raw { color: #ff9800; }
        .cleaned { color: #4CAF50; font-weight: bold; }
        h2 { color: #2196F3; }
    </style>
</head>
<body>
    <h1>üßπ Text Cleaning Test</h1>
    <p>Testing the cleanMovieTitle function with real examples...</p>

    <div id="results"></div>

    <script>
        // Copy of the cleanMovieTitle function
        const cleanMovieTitle = (rawText) => {
            console.log('üßπ Cleaning detected text...');
            console.log('Raw text:', rawText);

            if (!rawText || rawText.trim().length === 0) {
                return null;
            }

            const lines = rawText.split('\n').map(line => line.trim()).filter(line => line.length > 0);

            console.log('Lines found:', lines.length);
            console.log('Lines:', lines);

            const uiNoise = [
                'play', 'pause', 'watch', 'trailer', 'resume', 'continue watching',
                'add to list', 'my list', 'more info', 'details', 'info',
                'hd', 'uhd', '4k', 'ad', 'cc', 'audio description',
                'pg-13', 'pg', 'r', 'nr', 'tv-ma', 'tv-14', 'tv-pg', 'tv-y', 'tv-g',
                'episodes', 'seasons', 'season', 'episode',
                'download', 'share', 'rate', 'similar titles'
            ];

            const cleanedLines = lines.map(line => {
                let cleaned = line;

                cleaned = cleaned.replace(/^[#@$%^&*]+/, '');
                cleaned = cleaned.replace(/^\d+$/, '');
                cleaned = cleaned.replace(/^[+\-√óx]$/, '');
                cleaned = cleaned.replace(/^\d{4}$/, '');
                cleaned = cleaned.replace(/^\d+h?\s*\d*m?$/, '');
                cleaned = cleaned.replace(/^[0-9.,]+$/, '');

                const lowerCleaned = cleaned.toLowerCase();
                if (uiNoise.some(noise => lowerCleaned === noise)) {
                    return '';
                }

                if (cleaned.replace(/[a-zA-Z0-9]/g, '').length > cleaned.length * 0.5) {
                    return '';
                }

                if (cleaned.length <= 1) {
                    return '';
                }

                return cleaned.trim();
            }).filter(line => line.length > 0);

            console.log('Cleaned lines:', cleanedLines);

            if (cleanedLines.length === 0) {
                console.log('‚ö†Ô∏è  No clean text remaining after filtering');
                return null;
            }

            let title = cleanedLines[0];

            if (title.length < 3 && cleanedLines.length > 1) {
                title = cleanedLines[0] + ' ' + cleanedLines[1];
            }

            title = title
                .replace(/[#@$%^&*_+=|\\<>]/g, '')
                .replace(/\s+/g, ' ')
                .trim();

            console.log('‚ú® Extracted title:', title);
            return title || null;
        };

        // Test cases
        const testCases = [
            {
                name: "Your Actual Example (The Martian)",
                input: `#MARTIAN
D
Play
+
2
3374
–•
2015 2h 22m HD AD
PG-13 some strong language, injury images, and brief nu...`
            },
            {
                name: "Netflix Interface",
                input: `STRANGER THINGS
Play
S4:E1 Chapter One: The Hellfire Club
2022 | TV-14`
            },
            {
                name: "Simple Title Card",
                input: `INCEPTION`
            },
            {
                name: "Movie Poster",
                input: `THE DARK KNIGHT
COMING SOON`
            },
            {
                name: "Prime Video Interface",
                input: `The Lord of the Rings: The Fellowship of the Ring
Watch Now
Add to Watchlist
2001 2h 58m UHD`
            }
        ];

        // Run tests
        const resultsDiv = document.getElementById('results');

        testCases.forEach((testCase, index) => {
            console.log('\n========================================');
            console.log(`Test ${index + 1}: ${testCase.name}`);
            console.log('========================================');

            const cleaned = cleanMovieTitle(testCase.input);

            const testDiv = document.createElement('div');
            testDiv.className = 'test-case';
            testDiv.innerHTML = `
                <h2>Test ${index + 1}: ${testCase.name}</h2>
                <p><strong>Raw Input:</strong></p>
                <pre class="raw">${testCase.input}</pre>
                <p><strong>Cleaned Output:</strong></p>
                <pre class="cleaned">${cleaned || '(null - failed to extract)'}</pre>
            `;
            resultsDiv.appendChild(testDiv);
        });

        console.log('\n========================================');
        console.log('All tests complete! Check the page and console for results.');
    </script>
</body>
</html>
